<!DOCTYPE html>
<html lang="en">
  <style>
    /* Custom CSS untuk background texture navbar */
    .navbar-texture {
      background-image: url('/image/navTexture.webp'); /* Ganti dengan link tekstur */
      background-size: cover;
      background-repeat: no-repeat;
      background-color: rgba(0, 0, 0, 0.6); /* Warna hitam dengan transparansi 60% */
      background-blend-mode: overlay; /* Menggabungkan warna dan tekstur */
    }
  </style>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Riwayat Page</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Tambahkan Chart.js -->
  <script>
    function exportToExcel() {
      var wb = XLSX.utils.table_to_book(document.getElementById('reportTable'), {sheet: "Riwayat Report"});
      XLSX.writeFile(wb, 'Riwayat_Report.xlsx');
    }

    function updateTime() {
      const now = new Date();
      const timeString = now.toLocaleString();
      document.getElementById('currentTime').textContent = timeString;
    }

    setInterval(updateTime, 1000);

    // Data pelanggaran bulanan
    const dataPelanggaranBulanan = [
      { bulan: 'Januari', jumlah: 10 },
      { bulan: 'Februari', jumlah: 15 },
      { bulan: 'Maret', jumlah: 7 },
      { bulan: 'April', jumlah: 5 },
      { bulan: 'Mei', jumlah: 12 },
      { bulan: 'Juni', jumlah: 8 },
      { bulan: 'Juli', jumlah: 14 },
      { bulan: 'Agustus', jumlah: 9 },
      { bulan: 'September', jumlah: 11 },
      { bulan: 'Oktober', jumlah: 13 },
      { bulan: 'November', jumlah: 6 },
      { bulan: 'Desember', jumlah: 9 }
    ];

    // Data pelanggaran berdasarkan APD
    const dataAPD = [
      { apd: 'Helm Safety', jumlah: 40 },
      { apd: 'Baju Kerja', jumlah: 35 },
      { apd: 'Face Shield', jumlah: 25 },
      { apd: 'Masker', jumlah: 30 },
      { apd: 'Sepatu', jumlah: 28 }
    ];

    // Buat Grafik
    function createCharts() {
      const ctx1 = document.getElementById('infografisChart1').getContext('2d');
      const bulanLabels = dataPelanggaranBulanan.map(d => d.bulan);
      const jumlahPelanggaran = dataPelanggaranBulanan.map(d => d.jumlah);

      // Grafik 1: Pelanggaran per Bulan
      new Chart(ctx1, {
        type: 'line',
        data: {
          labels: bulanLabels,
          datasets: [{
            label: 'Jumlah Pelanggaran per Bulan',
            data: jumlahPelanggaran,
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            borderColor: 'rgba(75, 192, 192, 1)',
            borderWidth: 2,
            fill: true,
            tension: 0.4
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Jumlah Pelanggaran'
              }
            },
            x: {
              title: {
                display: true,
                text: 'Bulan'
              }
            }
          },
          plugins: {
            legend: {
              display: true,
              position: 'top'
            },
            tooltip: {
              callbacks: {
                label: function(tooltipItem) {
                  return 'Jumlah: ' + tooltipItem.raw;
                }
              }
            }
          }
        }
      });

      // Grafik 2: Pelanggaran APD
      const ctx2 = document.getElementById('infografisChart2').getContext('2d');
      const apdLabels = dataAPD.map(d => d.apd);
      const jumlahAPD = dataAPD.map(d => d.jumlah);

      new Chart(ctx2, {
        type: 'bar', // Menggunakan grafik batang
        data: {
          labels: apdLabels,
          datasets: [{
            label: 'Jumlah Pelanggaran APD',
            data: jumlahAPD,
            backgroundColor: 'rgba(255, 99, 132, 0.2)',
            borderColor: 'rgba(255, 99, 132, 1)',
            borderWidth: 2
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Jumlah Pelanggaran'
              }
            },
            x: {
              title: {
                display: true,
                text: 'Jenis APD'
              }
            }
          },
          plugins: {
            legend: {
              display: true,
              position: 'top'
            },
            tooltip: {
              callbacks: {
                label: function(tooltipItem) {
                  return 'Jumlah: ' + tooltipItem.raw;
                }
              }
            }
          }
        }
      });
    }

    window.onload = createCharts; // Panggil fungsi createCharts setelah halaman dimuat
  </script>
</head>
<body class="bg-gray-100">
  <!-- Container -->
  <div class="flex flex-col md:flex-row h-screen">
    <!-- Sidebar dengan tekstur -->
    <div class="w-full md:w-1/5 navbar-texture text-white p-6 shadow-lg flex flex-col justify-between">
      <!-- Logo -->
      <div class="text-center mb-8">
        <img src="image/logo.jpg" alt="Logo" class="w-24 h-24 mx-auto rounded-lg object-cover">
      </div>
      <!-- Navigation -->
      <nav>
        <ul class="space-y-4">
          <li><a href="index.html" class="block text-lg font-medium bg-gray-800 py-3 px-4 rounded-lg text-center hover:bg-blue-600 transition duration-200">Live Monitoring</a></li>
          <li><a href="riwayat.html" class="block text-lg font-medium bg-blue-600 py-3 px-4 rounded-lg text-center transition duration-200">Report</a></li>
          <li><a href="about.html" class="block text-lg font-medium bg-gray-800 py-3 px-4 rounded-lg text-center hover:bg-blue-600 transition duration-200">About</a></li>
        </ul>
      </nav>
      <!-- Footer -->
      <div class="mt-8"><p class="text-sm text-center text-gray-400">&copy; PT. KBEH2R</p></div>
    </div>

    <!-- Main Content -->
    <div class="flex-1 bg-white p-4 md:p-10 flex flex-col md:flex-row space-y-6 md:space-y-0 md:space-x-6">
      <!-- Left Column -->
      <div class="w-full md:w-2/3">
        <h2 class="text-3xl md:text-4xl font-bold mb-4">Laporan Pelanggaran</h2>
        <!-- Current Time -->
        <div class="mb-4"><p class="text-lg md:text-xl font-semibold">Current Time: <span id="currentTime" class="font-mono"></span></p></div>
        <!-- Export Button -->
        <div class="flex justify-end mb-4">
          <button onclick="exportToExcel()" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 md:py-3 px-4 md:px-6 rounded-lg shadow-md transition duration-300">Download Report</button>
        </div>
        <!-- Report Table -->
        <div class="overflow-x-auto mb-8">
          <table id="reportTable" class="min-w-full md:w-3/4 bg-white border-collapse border border-gray-300 shadow-md rounded-lg">
            <thead><tr class="bg-gray-100"><th class="py-2 md:py-3 px-4 md:px-6 text-left font-medium border-b border-gray-300">Tanggal</th><th class="py-2 md:py-3 px-4 md:px-6 text-left font-medium border-b border-gray-300">Waktu</th><th class="py-2 md:py-3 px-4 md:px-6 text-left font-medium border-b border-gray-300">Jumlah Pelanggar</th><th class="py-2 md:py-3 px-4 md:px-6 text-left font-medium border-b border-gray-300">Pelanggaran</th></tr></thead>
            <tbody>
              <tr><td class="py-2 md:py-3 px-4 md:px-6 border-b border-gray-300">2024-10-19</td><td class="py-2 md:py-3 px-4 md:px-6 border-b border-gray-300">10:30 AM</td><td class="py-2 md:py-3 px-4 md:px-6 border-b border-gray-300">5</td><td class="py-2 md:py-3 px-4 md:px-6 border-b border-gray-300">Pelanggaran Helm dan Wearpack</td></tr>
              <tr><td class="py-2 md:py-3 px-4 md:px-6 border-b border-gray-300">2024-10-18</td><td class="py-2 md:py-3 px-4 md:px-6 border-b border-gray-300">9:15 AM</td><td class="py-2 md:py-3 px-4 md:px-6 border-b border-gray-300">3</td><td class="py-2 md:py-3 px-4 md:px-6 border-b border-gray-300">Pelanggaran Kacamata</td></tr>
              <tr><td class="py-2 md:py-3 px-4 md:px-6 border-b border-gray-300">2024-10-17</td><td class="py-2 md:py-3 px-4 md:px-6 border-b border-gray-300">11:00 AM</td><td class="py-2 md:py-3 px-4 md:px-6 border-b border-gray-300">2</td><td class="py-2 md:py-3 px-4 md:px-6 border-b border-gray-300">Pelanggaran Sepatu</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Right Column -->
      <div class="w-full md:w-1/3 flex flex-col space-y-6">
        <h2 class="text-2xl font-bold">Infografis Pelanggaran</h2>
        <!-- Chart 1: Pelanggaran Bulanan -->
        <div class="bg-gray-100 rounded-lg shadow-lg p-6">
          <canvas id="infografisChart1"></canvas>
        </div>
        <!-- Chart 2: Pelanggaran APD -->
        <div class="bg-gray-100 rounded-lg shadow-lg p-6">
          <canvas id="infografisChart2"></canvas>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
